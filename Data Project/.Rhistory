paste(comma(volunteers), "volunteers"),
paste(comma(paid_staff), "paid staff"),
paste(percent(volunteers / (volunteers + paid_staff), 0.1),
"volunteer workforce"))),
colour = FSSIGreenSingle, alpha = 0.75,
line = "grey25") +
scale_x_continuous("Paid Staff",
labels = comma) +
scale_y_continuous("Volunteers",
labels = comma,
breaks = pretty_breaks(5)) +
scale_size_discrete("",
range = c(4, 8)) +
theme_minimal()
ggplotly(gg_SocServ_Volunteers_PaidStaff_1617,
tooltip = "text") %>%
add_annotations(text = "equal number volunteers to paid staff",
textangle = -32.62,
opacity = 0.5,
showarrow = FALSE,
xref = "x",
x = 20000,
yref = "y",
y = 22500) %>%
layout(legend = list(title = list(text = "Charity size",
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle"),
title = list(text = "Volunteers and Paid Staff Working for Social Services, 2016 to 2017",
xref = "canvas",
x = 0.1),
margin = list(t = 50,
b = 10,
l = 5,
r = 5),
font = list(family = FSSIfont,
size = 12))
ggplotly(gg_SocServ_Volunteers_PaidStaff_678,
tooltip = "text") %>%
add_annotations(text = "equal number volunteers to paid staff",
textangle = -32.62,
opacity = 0.5,
showarrow = FALSE,
xref = "x",
x = 20000,
yref = "y",
y = 22500) %>%
layout(legend = list(title = list(text = "Charity size",
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle"),
title = list(text = "Volunteers and Paid Staff Working for Social Services, 2016 to 2017",
xref = "canvas",
x = 0.1),
margin = list(t = 50,
b = 10,
l = 5,
r = 5),
font = list(family = FSSIfont,
size = 12))
Volunteers_PaidStaff_678_long <- pivot_longer(Volunteers_PaidStaff_678,
cols = c(paid_staff, volunteers),
names_to = "staff_type",
values_to = "staff_count")
Volunteers_PaidStaff_678_long <- mutate(group_by(Volunteers_PaidStaff_678_long,
main_activity, charity_size, Year),
proportion = (staff_count / sum(staff_count)))
activity <- unique(Volunteers_PaidStaff_678_long$main_activity)
plot_ly(data = filter(Volunteers_PaidStaff_678_long,
str_detect(main_activity,
regex("social services",
ignore_case = TRUE))),
type = "pie",
labels = ~str_cleaner(staff_type),
values = ~staff_count,
frame = ~Year,
hovertemplate = paste(sep = "\n",
"%{value} %{label}",
activity[1],
"<extra></extra>"),
marker = list(colors = c("rgb(84, 144, 65))",
"rgb(77, 234, 229"),
line = list(color = "#cecece",
width = 0.85))) %>%
layout(title = list(text = "Volunteer Workforce Share for Social Services, 2016 to 2017",
standoff = 10,
xref = "canvas",
x = 0.1),
font = list(family = FSSIfont,
size = 12),
legend = list(title = list(text = "Staff employment type",
font = list(size = 14))))
VCOSS_TotalRev_1617 <- transmute(VCOSS_ACNC_16,
main_activity = main_activity_2016,
total_revenue = total_revenue_2016,
Year = 2016)
VCOSS_TotalRev_1617 <- rbind(VCOSS_TotalRev_1617,
transmute(VCOSS_ACNC_17,
main_activity = main_activity,
total_revenue = total_revenue_2017,
Year = 2017))
VCOSS_TotalRev_1617 <- mutate(VCOSS_TotalRev_1617,
activity_group = if_else(str_detect(main_activity,
regex("social services",
ignore_case = TRUE)),
true = "Social Services",
false = "Other Sectors"))
gg_TotalRev_hist <- ggplot(filter(VCOSS_TotalRev_1617,
total_revenue > 0)) +
geom_histogram(aes(x = total_revenue,
fill = activity_group,
text = paste(sep = "\n",
paste(comma(..count..), "charities"),
paste(dollar(..x..), "total revenue"),
fill)),
col = "grey40",
bins = 24) +
scale_x_continuous("Total Revenue",
labels = dollar_format(accuracy = 1,
scale = 0.000001,
suffix = "m"),
n.breaks = 5) +
scale_y_continuous("Number of Charities",
labels = comma) +
facet_wrap(Year ~ activity_group,
scales = "free_y") +
scale_fill_manual("",
values = c(FSSIQualSingle(2), FSSIGreenSingle)) +
theme_minimal() +
theme(panel.spacing.y = unit(3, "cm"))
pl_TotalRev_hist <- ggplotly(gg_TotalRev_hist,
tooltip = "text")
gg_TotalRev_loghist <- ggplot(VCOSS_TotalRev_1617) +
geom_histogram(aes(x = total_revenue,
fill = activity_group,
text = paste(sep = "\n",
paste(comma(..count..), "charities"),
paste(dollar(..x..^10), "total revenue"),
fill)),
col = "grey40",
bins = 24) +
scale_x_log10("Total Revenue",
labels = dollar,
n.breaks = 5) +
scale_y_continuous("Number of Charities",
labels = comma) +
facet_wrap(Year ~ activity_group ,
scales = "free_y") +
scale_fill_manual("",
values = c(FSSIQualSingle(2), FSSIGreenSingle)) +
theme_minimal() +
theme(panel.spacing.y = unit(3, "cm"))
pl_TotalRev_loghist <- ggplotly(gg_TotalRev_loghist,
tooltip = "text")
subplot(pl_TotalRev_hist, pl_TotalRev_loghist,
nrows = 2,
margin = c(0, 0,
0.066, 0.066)) %>%
layout(title = list(text = "Distribution of Total Revenue on Standard and Logarithmic Scales",
standoff = 20,
xref = "canvas",
x = 0.1),
legend = list(title = list(text = "Main Activity",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle"),
margin = list(t = 80, b = 10,
l = 5, r = 5),
font = list(family = FSSIfont,
size = 12),
xaxis = list(title = list(text = "Total Revenue - standard scale",
standoff = 0)),
xaxis2 = list(title = list(text = "Total Revenue - standard scale",
standoff = 0)),
xaxis3 = list(title = list(text = "Total Revenue - logarithmic scale",
standoff = 1)),
xaxis4 = list(title = list(text = "Total Revenue - logarithmic scale",
standoff = 1)),
yaxis = list(title = list(text = "Number of\nCharities",
standoff = 5)),
yaxis3 = list(title = list(text = "Number of\nCharities",
standoff = 5)),
yaxis5 = list(title = list(text = "Number of\nCharities",
standoff = 5)),
yaxis7 = list(title = list(text = "Number of\nCharities",
standoff = 5)))
VCOSS_TotalRev_1617 <- transmute(VCOSS_ACNC_16,
main_activity = main_activity_2016,
total_revenue = total_revenue_2016,
Year = 2016)
VCOSS_TotalRev_1617 <- rbind(VCOSS_TotalRev_1617,
transmute(VCOSS_ACNC_17,
main_activity = main_activity,
total_revenue = total_revenue_2017,
Year = 2017))
VCOSS_TotalRev_1617 <- mutate(VCOSS_TotalRev_1617,
activity_group = if_else(str_detect(main_activity,
regex("social services",
ignore_case = TRUE)),
true = "Social Services",
false = "Other Sectors"))
gg_TotalRev_hist <- ggplot(filter(VCOSS_TotalRev_1617,
total_revenue > 0)) +
geom_histogram(aes(x = total_revenue,
fill = activity_group,
text = paste(sep = "\n",
paste(comma(..count..), "charities"),
paste(dollar(..x..), "total revenue"),
fill)),
col = "grey40",
bins = 24) +
scale_x_continuous("Total Revenue",
labels = dollar_format(accuracy = 1,
scale = 0.000001,
suffix = "m"),
n.breaks = 5) +
scale_y_continuous("Number of Charities",
labels = comma) +
facet_wrap(Year ~ activity_group,
scales = "free_y") +
scale_fill_manual("",
values = c(FSSIQualSingle(2), FSSIGreenSingle)) +
theme_minimal() +
theme(panel.spacing.y = unit(3, "cm"))
pl_TotalRev_hist <- ggplotly(gg_TotalRev_hist,
tooltip = "text")
gg_TotalRev_loghist <- ggplot(VCOSS_TotalRev_1617) +
geom_histogram(aes(x = total_revenue,
fill = activity_group,
text = paste(sep = "\n",
paste(comma(..count..), "charities"),
paste(dollar(..x..^10), "total revenue"),
fill)),
col = "grey40",
bins = 24) +
scale_x_log10("Total Revenue",
labels = dollar,
n.breaks = 5) +
scale_y_continuous("Number of Charities",
labels = comma) +
facet_wrap(Year ~ activity_group ,
scales = "free_y") +
scale_fill_manual("",
values = c(FSSIQualSingle(2), FSSIGreenSingle)) +
theme_minimal() +
theme(panel.spacing.y = unit(3, "cm"))
pl_TotalRev_loghist <- ggplotly(gg_TotalRev_loghist,
tooltip = "text")
subplot(pl_TotalRev_hist, pl_TotalRev_loghist,
nrows = 2,
margin = c(0, 0,
0.066, 0.066)) %>%
layout(title = list(text = "Distribution of Total Revenue on Standard and Logarithmic Scales",
standoff = 20,
xref = "canvas",
x = 0.1),
legend = list(title = list(text = "Main Activity",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle"),
margin = list(t = 80, b = 10,
l = 5, r = 5),
font = list(family = FSSIfont,
size = 12),
xaxis = list(title = list(text = "Total Revenue - standard scale",
standoff = 0)),
xaxis2 = list(title = list(text = "Total Revenue - standard scale",
standoff = 0)),
xaxis3 = list(title = list(text = "Total Revenue - logarithmic scale",
standoff = 1)),
xaxis4 = list(title = list(text = "Total Revenue - logarithmic scale",
standoff = 1)),
yaxis = list(title = list(text = "Number of\nCharities",
standoff = 5)),
yaxis3 = list(title = list(text = "Number of\nCharities",
standoff = 5)),
yaxis5 = list(title = list(text = "Number of\nCharities",
standoff = 5)),
yaxis7 = list(title = list(text = "Number of\nCharities",
standoff = 5)))
## 2016
VCOSS_ACNC_16_ordered <- arrange(VCOSS_ACNC_16, main_activity_2016)
VCOSS_ACNC_16_ordered <- cbind(VCOSS_ACNC_16_ordered,
circleProgressiveLayout(VCOSS_ACNC_16_ordered$total_revenue_2016))
packing_16 <- circleLayoutVertices(layout = VCOSS_ACNC_16_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_16 <- left_join(packing_16,
select(VCOSS_ACNC_16_ordered,
charity_name,
main_activity = main_activity_2016,
total_revenue = total_revenue_2016,
radius),
by = c("id" = "charity_name"))
packing_16$Year <- 2016
## 2017
VCOSS_ACNC_17_ordered <- arrange(VCOSS_ACNC_17, main_activity)
VCOSS_ACNC_17_ordered <- cbind(VCOSS_ACNC_17_ordered,
circleProgressiveLayout(VCOSS_ACNC_17_ordered$total_revenue_2017))
packing_17 <- circleLayoutVertices(layout = VCOSS_ACNC_17_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_17 <- left_join(packing_17,
select(VCOSS_ACNC_17_ordered,
charity_name, main_activity,
total_revenue = total_revenue_2017,
radius),
by = c("id" = "charity_name"))
packing_17$Year <- 2017
## 2018
VCOSS_ACNC_18_ordered <- arrange(VCOSS_ACNC_18, main_activity)
VCOSS_ACNC_18_ordered <- cbind(VCOSS_ACNC_18_ordered,
circleProgressiveLayout(VCOSS_ACNC_18_ordered$total_revenue))
packing_18 <- circleLayoutVertices(layout = VCOSS_ACNC_18_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_18 <- left_join(packing_18,
select(VCOSS_ACNC_18_ordered,
charity_name, main_activity,
total_revenue = total_revenue_2018,
radius),
by = c("id" = "charity_name"))
## 2016
VCOSS_ACNC_16_ordered <- arrange(VCOSS_ACNC_16, main_activity_2016)
VCOSS_ACNC_16_ordered <- cbind(VCOSS_ACNC_16_ordered,
circleProgressiveLayout(VCOSS_ACNC_16_ordered$total_revenue_2016))
packing_16 <- circleLayoutVertices(layout = VCOSS_ACNC_16_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_16 <- left_join(packing_16,
select(VCOSS_ACNC_16_ordered,
charity_name,
main_activity = main_activity_2016,
total_revenue = total_revenue_2016,
radius),
by = c("id" = "charity_name"))
packing_16$Year <- 2016
## 2017
VCOSS_ACNC_17_ordered <- arrange(VCOSS_ACNC_17, main_activity)
VCOSS_ACNC_17_ordered <- cbind(VCOSS_ACNC_17_ordered,
circleProgressiveLayout(VCOSS_ACNC_17_ordered$total_revenue_2017))
packing_17 <- circleLayoutVertices(layout = VCOSS_ACNC_17_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_17 <- left_join(packing_17,
select(VCOSS_ACNC_17_ordered,
charity_name, main_activity,
total_revenue = total_revenue_2017,
radius),
by = c("id" = "charity_name"))
packing_17$Year <- 2017
## 2018
VCOSS_ACNC_18_ordered <- arrange(VCOSS_ACNC_18, main_activity)
VCOSS_ACNC_18_ordered <- cbind(VCOSS_ACNC_18_ordered,
circleProgressiveLayout(VCOSS_ACNC_18_ordered$total_revenue))
packing_18 <- circleLayoutVertices(layout = VCOSS_ACNC_18_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_18 <- left_join(packing_18,
select(VCOSS_ACNC_18_ordered,
charity_name, main_activity,
total_revenue,
radius),
by = c("id" = "charity_name"))
packing_18$Year <- 2018
# binding
packing_678 <- rbind(packing_16, packing_17)
## plot
gg_packing <- ggplot(packing_678) +
geom_point(aes(x = x,
y = y,
size = radius,
fill = str_clean_wrap(factor(main_activity), 28),
frame = Year,
text = paste(sep = "\n",
id,
main_activity,
paste(dollar(total_revenue), "total revenue"))),
colour = "grey66",
alpha = 0.8) +
scale_size_continuous("",
range = c(2, 11)) +
scale_x_symmetric("",
mid = 0,
expand = c(0.075, 0.075)) +
scale_y_symmetric("",
mid = 0,
expand = c(0.05, 0.05)) +
scale_fill_manual("",
values = FSSIQualPal(13)) +
coord_equal() +
theme_minimal() +
theme(panel.grid = element_blank(),
axis.text = element_blank())
ggplotly(gg_packing,
tooltip = "text") %>%
layout(legend = list(title = list(text = "Main Activity",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle"),
title = list(text = "Total Revenue for all Victorian Charities, 2016 to 2017",
xref = "canvas",
x = 0.1),
margin = list(t = 45, b = 10,
l = 5, r = 5))
## 2016
VCOSS_ACNC_16_ordered <- arrange(VCOSS_ACNC_16, main_activity_2016)
VCOSS_ACNC_16_ordered <- cbind(VCOSS_ACNC_16_ordered,
circleProgressiveLayout(VCOSS_ACNC_16_ordered$total_revenue_2016))
packing_16 <- circleLayoutVertices(layout = VCOSS_ACNC_16_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_16 <- left_join(packing_16,
select(VCOSS_ACNC_16_ordered,
charity_name,
main_activity = main_activity_2016,
total_revenue = total_revenue_2016,
radius),
by = c("id" = "charity_name"))
packing_16$Year <- 2016
## 2017
VCOSS_ACNC_17_ordered <- arrange(VCOSS_ACNC_17, main_activity)
VCOSS_ACNC_17_ordered <- cbind(VCOSS_ACNC_17_ordered,
circleProgressiveLayout(VCOSS_ACNC_17_ordered$total_revenue_2017))
packing_17 <- circleLayoutVertices(layout = VCOSS_ACNC_17_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_17 <- left_join(packing_17,
select(VCOSS_ACNC_17_ordered,
charity_name, main_activity,
total_revenue = total_revenue_2017,
radius),
by = c("id" = "charity_name"))
packing_17$Year <- 2017
## 2018
VCOSS_ACNC_18_ordered <- arrange(VCOSS_ACNC_18, main_activity)
VCOSS_ACNC_18_ordered <- cbind(VCOSS_ACNC_18_ordered,
circleProgressiveLayout(VCOSS_ACNC_18_ordered$total_revenue))
packing_18 <- circleLayoutVertices(layout = VCOSS_ACNC_18_ordered,
npoints = 0,
xysizecols = c("x", "y", "radius"),
sizetype = "area",
idcol = "charity_name")
packing_18 <- left_join(packing_18,
select(VCOSS_ACNC_18_ordered,
charity_name, main_activity,
total_revenue,
radius),
by = c("id" = "charity_name"))
packing_18$Year <- 2018
# binding
packing_678 <- rbind(packing_16,
packing_17,
packing_18)
## plot
gg_packing_678 <- ggplot(packing_678) +
geom_point(aes(x = x,
y = y,
size = radius,
fill = str_clean_wrap(factor(main_activity), 28),
frame = Year,
text = paste(sep = "\n",
id,
main_activity,
paste(dollar(total_revenue), "total revenue"))),
colour = "grey66",
alpha = 0.8) +
scale_size_continuous("",
range = c(2, 11)) +
scale_x_symmetric("",
mid = 0,
expand = c(0.075, 0.075)) +
scale_y_symmetric("",
mid = 0,
expand = c(0.05, 0.05)) +
scale_fill_manual("",
values = FSSIQualPal(13)) +
coord_equal() +
theme_minimal() +
theme(panel.grid = element_blank(),
axis.text = element_blank())
ggplotly(gg_packing_678,
tooltip = "text") %>%
layout(legend = list(title = list(text = "Main Activity",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle"),
title = list(text = "Total Revenue for all Victorian Charities, 2016 to 2017",
xref = "canvas",
x = 0.1),
margin = list(t = 45, b = 10,
l = 5, r = 5))
